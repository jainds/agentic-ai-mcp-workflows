# FastMCP Services Dockerfile
FROM python:3.13-slim AS base

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# Copy minimal requirements for FastMCP services
COPY requirements-fastmcp.txt .
RUN pip install --no-cache-dir -r requirements-fastmcp.txt

# Copy only the necessary project files
COPY services/ services/
COPY agents/technical/fastmcp_data_agent.py agents/technical/fastmcp_data_agent.py
COPY agents/__init__.py agents/
COPY agents/technical/__init__.py agents/technical/

# User Service Image
FROM base AS user-service
EXPOSE 8000
ENV USE_FASTMCP=true
ENV USER_SERVICE_HOST=0.0.0.0
ENV USER_SERVICE_PORT=8000
CMD ["python", "services/user_service/main.py"]

# Claims Service Image  
FROM base AS claims-service
EXPOSE 8001
ENV USE_FASTMCP=true
ENV CLAIMS_SERVICE_HOST=0.0.0.0
ENV CLAIMS_SERVICE_PORT=8001
CMD ["python", "services/claims_service/main.py"]

# Policy Service Image
FROM base AS policy-service
EXPOSE 8002
ENV USE_FASTMCP=true
ENV POLICY_SERVICE_HOST=0.0.0.0
ENV POLICY_SERVICE_PORT=8002
CMD ["python", "services/policy_service/main.py"]

# Analytics Service Image
FROM base AS analytics-service
EXPOSE 8003
ENV USE_FASTMCP=true
ENV ANALYTICS_SERVICE_HOST=0.0.0.0
ENV ANALYTICS_SERVICE_PORT=8003
CMD ["python", "services/analytics_service/main.py"]

# FastMCP Data Agent Image
FROM base AS fastmcp-data-agent
EXPOSE 8004
ENV FASTMCP_DATA_AGENT_PORT=8004
ENV USER_SERVICE_URL=http://user-service:8000
ENV CLAIMS_SERVICE_URL=http://claims-service:8001
ENV POLICY_SERVICE_URL=http://policy-service:8002
ENV ANALYTICS_SERVICE_URL=http://analytics-service:8003
CMD ["python", "agents/technical/fastmcp_data_agent.py"] 